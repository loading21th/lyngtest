upstream inner {
    sticky name=nameck;
    server 10.41.42.40:8081 weight=2;
    server 10.41.42.40:8082 weight=1;

}

server {
	listen 8081;
    location /ok {
        echo 200 "listen 8081 \n";
    }
}

server {
	listen 8082;
    location /ok {
        echo 200 "listen 8082 \n";
    }
}

server {
	listen 8080;
    server_name www.upstream.com;

    autoindex on;

    location / {
        default_type 'text/html';
        more_set_headers "ly: ly"
        root html;
    }

    location /ok {
        default_type 'text/html';
        more_set_headers "ly: ly";
        proxy_set_header conf "conf_test";
        proxy_pass http://inner;
    }

}
